zerops:
  - setup: dotnet0
    build:
      base: dotnet@8  # Use .NET 8 SDK for building

      buildCommands:
        - dotnet tool restore  # Restore any tools defined in the tool manifest
        - dotnet tool install --global dotnet-ef  # Ensure dotnet-ef is available for migrations
        - dotnet ef database update
        - dotnet restore  # Restore dependencies for the application
        - dotnet build -o app  # Build the application and output to the app directory

      deployFiles: app/~  # Deploy the app files to Zerops

    run:
      base: dotnet@8  # Use .NET 8 runtime
      ports:
        - port: 7100
          httpSupport: true
      start: |
        dotnet tool install --global dotnet-ef
        dotnet ef database update --project ./api/api.csproj --startup-project ./api/api.csproj
        dotnet api.dll

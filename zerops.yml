zerops:
  - setup: dotnet0
    # ==== how to build your application ====
    build:
      # Base container to build the application
      base: dotnet@8

      # Install dotnet-ef tool globally
      buildCommands:
        - dotnet tool restore  # Restore any tools defined in the tool manifest (if you have one)
        - dotnet tool install --global dotnet-ef  # Ensure dotnet-ef is installed globally

        # Build the application
        - dotnet build -o app

        # Add initial migration if necessary
        - dotnet ef migrations add InitialCreate --no-build
        
        # Update the database with migrations
        - dotnet ef database update

      # Deploy files after successful build
      deployFiles: app/~

    # ==== How to run your application ====
    run:
      base: dotnet@8
      ports:
        - port: 7100
          httpSupport: true
      start: dotnet api.dll
